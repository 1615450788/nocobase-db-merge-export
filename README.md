# NocoBase æ•°æ®åº“å¯¼å‡ºåˆå¹¶å·¥å…· (DBM)

[English](README.en.md) | ç®€ä½“ä¸­æ–‡

ç”¨äº NocoBase åº”ç”¨ç‰ˆæœ¬å‡çº§æ—¶,ä»ä¸¤ä¸ªæ•°æ®åº“å¯¼å‡ºå¹¶åˆå¹¶æ•°æ®çš„ä¸“ä¸šå·¥å…·ã€‚æ”¯æŒ MySQL / MariaDBã€‚

## æ ¸å¿ƒåŠŸèƒ½

### ğŸš€ æ™ºèƒ½æ•°æ®åˆå¹¶
- **ç»“æ„æ¥è‡ª Source**ï¼šå¯¼å‡º Source æ•°æ®åº“çš„å®Œæ•´è¡¨ç»“æ„
- **æ•°æ®æ··åˆå¯¼å…¥**ï¼šå¤§éƒ¨åˆ†æ•°æ®æ¥è‡ª Sourceï¼ŒæŒ‡å®šè¡¨çš„æ•°æ®æ¥è‡ª Target
- **è‡ªåŠ¨åˆ—åŒ¹é…**ï¼šæ™ºèƒ½å¤„ç†è¡¨ç»“æ„å·®å¼‚ï¼Œåªå¯¼å‡ºå…¬å…±åˆ—
- **å»é‡ä¿æŠ¤**ï¼šä½¿ç”¨ `REPLACE INTO` è‡ªåŠ¨å¤„ç†ä¸»é”®å†²çª

### ğŸ“¦ é¢„è®¾è¡¨ç»„åˆ
- **ç»„åˆ1ï¼šå®¡æ‰¹æ•°æ®**ï¼ˆ8ä¸ªå›ºå®šè¡¨ï¼‰- å·¥ä½œæµã€å®¡æ‰¹ç›¸å…³ï¼Œ**è‡ªåŠ¨åŒ…å«å¤šå¯¹å¤šå…³è”è¡¨**
- **ç»„åˆ2ï¼šä¸šåŠ¡æ•°æ®**ï¼ˆåŠ¨æ€è·å–ï¼‰- ä» `collections` è¡¨è‡ªåŠ¨è¯»å–ï¼Œ**è‡ªåŠ¨åŒ…å«å¤šå¯¹å¤šå…³è”è¡¨**
- **ç»„åˆ3ï¼šå…¨éƒ¨æ•°æ®**ï¼ˆç»„åˆ1+2ï¼‰- å®Œæ•´ç”Ÿäº§ç¯å¢ƒæ•°æ®ï¼Œ**è‡ªåŠ¨åŒ…å«æ‰€æœ‰å¤šå¯¹å¤šå…³è”è¡¨**
- **è‡ªå®šä¹‰ç»„åˆ** - æ‰‹åŠ¨æŒ‡å®šä»»æ„è¡¨åˆ—è¡¨ï¼Œ**è‡ªåŠ¨åŒ…å«å¤šå¯¹å¤šå…³è”è¡¨**

### ğŸ›¡ï¸ æ•°æ®å®‰å…¨ç‰¹æ€§
- âœ… **BIGINT ç²¾åº¦ä¿æŠ¤** - é¿å…å¤§æ•´æ•°æº¢å‡ºå¯¼è‡´çš„æ•°æ®æŸå
- âœ… **åˆ—å·®å¼‚å®¹é”™** - Source å’Œ Target è¡¨ç»“æ„ç‰ˆæœ¬ä¸ä¸€è‡´æ—¶è‡ªåŠ¨å¤„ç†
- âœ… **è™šæ‹Ÿè¡¨è¿‡æ»¤** - è‡ªåŠ¨è·³è¿‡ NocoBase çš„è™šæ‹Ÿè¡¨
- âœ… **é‡å¤è¡¨å»é‡** - è‡ªåŠ¨æ£€æµ‹å¹¶å»é™¤é‡å¤çš„è¡¨å
- âœ… **äº‹åŠ¡æ”¯æŒ** - ä½¿ç”¨ `--single-transaction` ä¿è¯æ•°æ®ä¸€è‡´æ€§
- âœ… **å¤šå¯¹å¤šå…³è”è¡¨è‡ªåŠ¨æ£€æµ‹** - è‡ªåŠ¨æŸ¥è¯¢å¹¶åŒ…å«æ’é™¤è¡¨çš„ m2m å­—æ®µå…³è”è¡¨ï¼ˆjunction tablesï¼‰
- âœ… **DB_UNDERSCORED æ”¯æŒ** - è‡ªåŠ¨è½¬æ¢é©¼å³°/ä¸‹åˆ’çº¿è¡¨åï¼Œé€‚é…ä¸åŒçš„ NocoBase é…ç½®

### ğŸ¯ ç”¨æˆ·ä½“éªŒ
- âœ… **äº¤äº’å¼å‘å¯¼** - å‹å¥½çš„é—®ç­”å¼é…ç½®æµç¨‹
- âœ… **è‡ªåŠ¨æ—¶é—´æˆ³** - æ¯æ¬¡å¯¼å‡ºç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼Œä¸è¦†ç›–å†å²
- âœ… **è¯¦ç»†æ—¥å¿—** - å®æ—¶æ˜¾ç¤ºå¯¼å‡ºè¿›åº¦å’Œè¡¨ä¿¡æ¯
- âœ… **åˆ—å·®å¼‚æç¤º** - è‡ªåŠ¨æç¤º Source ç‹¬æœ‰åˆ—å’Œ Target ç‹¬æœ‰åˆ—
- âœ… **ä¸€é”®å®‰è£…** - æ”¯æŒå…¨å±€å®‰è£…ï¼Œä»»æ„ç›®å½•ä½¿ç”¨

## å®‰è£…

### å…¨å±€å®‰è£…ï¼ˆæ¨èï¼‰

```bash
npm install -g nocobase-db-merge-export
```

å®‰è£…åå¯åœ¨ä»»ä½•ç›®å½•ä½¿ç”¨ `dbm` å‘½ä»¤ã€‚

### æœ¬åœ°å®‰è£…

```bash
npm install
```

## å¿«é€Ÿå¼€å§‹

### 1. äº¤äº’å¼ç”Ÿæˆé…ç½®æ–‡ä»¶

```bash
dbm --init
```

è¯¥å‘½ä»¤å°†å¯åŠ¨äº¤äº’å¼é…ç½®å‘å¯¼ï¼Œå¼•å¯¼æ‚¨å®Œæˆé…ç½®ï¼š

```
ğŸ”§ é…ç½®æ•°æ®åº“å¯¼å‡ºå·¥å…·

ğŸ“¦ Source æ•°æ®åº“é…ç½®ï¼ˆå¯¼å‡ºç»“æ„å’Œå¤§éƒ¨åˆ†æ•°æ®ï¼‰:

? Source æ•°æ®åº“ä¸»æœº: 127.0.0.1
? Source æ•°æ®åº“ç«¯å£: 3306
? Source æ•°æ®åº“ç”¨æˆ·å: root
? Source æ•°æ®åº“å¯†ç : ****
? Source æ•°æ®åº“å: nocobase_dev

ğŸ“¦ Target æ•°æ®åº“é…ç½®ï¼ˆæä¾›æ’é™¤è¡¨çš„æ•°æ®ï¼‰:

? Target æ•°æ®åº“è¿æ¥ä¿¡æ¯æ˜¯å¦ä¸ Source ç›¸åŒ? Yes
? Target æ•°æ®åº“å: nocobase_prod

âš™ï¸  å¯¼å‡ºé…ç½®:

? é€‰æ‹©æ’é™¤è¡¨ç»„åˆï¼ˆè¿™äº›è¡¨çš„æ•°æ®å°†ä» Target æ•°æ®åº“è·å–ï¼‰:
  â¯ ç»„åˆ1: å®¡æ‰¹æ•°æ®ï¼ˆå·¥ä½œæµã€å®¡æ‰¹ç›¸å…³è¡¨ï¼‰
    ç»„åˆ2: ä¸šåŠ¡æ•°æ®ï¼ˆä» collections è¡¨è·å–ï¼‰
    ç»„åˆ3: å…¨éƒ¨æ•°æ®ï¼ˆå®¡æ‰¹æ•°æ® + ä¸šåŠ¡æ•°æ®ï¼‰
    è‡ªå®šä¹‰ï¼ˆæ‰‹åŠ¨è¾“å…¥ï¼‰

   âœ“ å·²é€‰æ‹©å®¡æ‰¹æ•°æ®ç»„åˆ (8 ä¸ªè¡¨)
      - workflow_cc_tasks
      - user_workflow_tasks
      - approval_records
      - approval_executions
      - jobs
      - executions
      - approvals
      - workflow_stats

   è¾“å‡ºæ–‡ä»¶: ./merged_export_20251015_143025.sql

âœ“ é…ç½®æ–‡ä»¶å·²ç”Ÿæˆ: config.json
```

### 2. æˆ–æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶

å¦‚æœæ‚¨æ›´å–œæ¬¢æ‰‹åŠ¨ç¼–è¾‘ï¼Œå¯ä»¥ç›´æ¥åˆ›å»º `config.json`ï¼š

```json
{
  "source": {
    "host": "127.0.0.1",
    "port": 3306,
    "user": "root",
    "password": "123456",
    "database": "nocobase_dev"
  },
  "target": {
    "host": "127.0.0.1",
    "port": 3306,
    "user": "root",
    "password": "123456",
    "database": "nocobase_prod"
  },
  "export": {
    "excludeTables": [
      "workflow_cc_tasks",
      "user_workflow_tasks",
      "approval_records",
      "approval_executions",
      "jobs",
      "executions",
      "approvals",
      "workflow_stats"
    ],
    "outputFile": "./merged_export.sql",
    "dbUnderscored": true
  }
}
```

#### é…ç½®å‚æ•°è¯´æ˜

- **source**: æºæ•°æ®åº“é…ç½®ï¼ˆå¯¼å‡ºç»“æ„å’Œå¤§éƒ¨åˆ†æ•°æ®ï¼‰
- **target**: ç›®æ ‡æ•°æ®åº“é…ç½®ï¼ˆæä¾›æ’é™¤è¡¨çš„æ•°æ®ï¼‰
- **export.excludeTables**: éœ€è¦ä» target æ•°æ®åº“è·å–æ•°æ®çš„è¡¨åˆ—è¡¨
- **export.outputFile**: è¾“å‡ºçš„ SQL æ–‡ä»¶è·¯å¾„
- **export.dbUnderscored**: ï¼ˆå¯é€‰ï¼‰NocoBase DB_UNDERSCORED é…ç½®
  - `true`: å¯ç”¨ä¸‹åˆ’çº¿å‘½åï¼Œé©¼å³°è¡¨åè‡ªåŠ¨è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼ˆå¦‚ `userRoles` -> `user_roles`ï¼‰
  - `false`: ç¦ç”¨ä¸‹åˆ’çº¿å‘½åï¼Œä¸‹åˆ’çº¿è¡¨åè‡ªåŠ¨è½¬æ¢ä¸ºé©¼å³°ï¼ˆå¦‚ `user_roles` -> `userRoles`ï¼‰
  - `undefined` æˆ–ä¸è®¾ç½®: ä¿æŒåŸè¡¨åï¼Œä¸è¿›è¡Œè½¬æ¢

#### é¢„è®¾è¡¨ç»„åˆè¯´æ˜

**ç»„åˆ1ï¼šå®¡æ‰¹æ•°æ®**ï¼ˆé»˜è®¤ï¼‰
- åŒ…å«å·¥ä½œæµã€å®¡æ‰¹ç›¸å…³çš„ 8 ä¸ªè¡¨
- é€‚ç”¨äºéœ€è¦ä¿ç•™ç”Ÿäº§ç¯å¢ƒçš„å®¡æ‰¹æµç¨‹æ•°æ®
- è¡¨åˆ—è¡¨ï¼š
  - `workflow_cc_tasks` - å·¥ä½œæµæŠ„é€ä»»åŠ¡
  - `user_workflow_tasks` - ç”¨æˆ·å·¥ä½œæµä»»åŠ¡
  - `approval_records` - å®¡æ‰¹è®°å½•
  - `approval_executions` - å®¡æ‰¹æ‰§è¡Œ
  - `jobs` - ä½œä¸šä»»åŠ¡
  - `executions` - æ‰§è¡Œè®°å½•
  - `approvals` - å®¡æ‰¹
  - `workflow_stats` - å·¥ä½œæµç»Ÿè®¡

**ç»„åˆ2ï¼šä¸šåŠ¡æ•°æ®**
- è‡ªåŠ¨ä» Target æ•°æ®åº“çš„ `collections` è¡¨è¯»å–ä¸šåŠ¡è¡¨åˆ—è¡¨
- è‡ªåŠ¨è¿‡æ»¤è™šæ‹Ÿè¡¨ï¼ˆä»…å¯¼å‡ºçœŸå®å­˜åœ¨çš„è¡¨ï¼‰
- é€‚ç”¨äºéœ€è¦ä¿ç•™ç”Ÿäº§ç¯å¢ƒçš„æ‰€æœ‰ä¸šåŠ¡æ•°æ®
- è¡¨æ•°é‡åŠ¨æ€ï¼Œå–å†³äºæ‚¨çš„ NocoBase åº”ç”¨é…ç½®

**ç»„åˆ3ï¼šå…¨éƒ¨æ•°æ®**ï¼ˆæ¨èç”¨äºå®Œæ•´è¿ç§»ï¼‰
- åŒ…å«ç»„åˆ1 + ç»„åˆ2 çš„æ‰€æœ‰è¡¨
- è‡ªåŠ¨å»é‡ï¼Œé¿å…é‡å¤è¡¨å
- é€‚ç”¨äºéœ€è¦å®Œæ•´ä¿ç•™ç”Ÿäº§ç¯å¢ƒæ•°æ®çš„åœºæ™¯
- åŒæ—¶ä¿ç•™å®¡æ‰¹æµç¨‹å’Œä¸šåŠ¡æ•°æ®

**è‡ªå®šä¹‰**
- æ‰‹åŠ¨è¾“å…¥è¡¨ååˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰
- å®Œå…¨è‡ªå®šä¹‰æ§åˆ¶

### 3. æ‰§è¡Œå¯¼å‡º

é…ç½®å®Œæˆåï¼Œè¿è¡Œå¯¼å‡ºå‘½ä»¤ï¼š

```bash
dbm
```

**æ³¨æ„**ï¼šæ¯æ¬¡å¯¼å‡ºéƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„å”¯ä¸€æ–‡ä»¶åï¼Œæ ¼å¼ä¸º `merged_export_YYYYMMDD_HHMMSS.sql`ï¼Œæ— éœ€æ‹…å¿ƒè¦†ç›–ä¹‹å‰çš„å¯¼å‡ºæ–‡ä»¶ã€‚

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œé€‰é¡¹

```bash
# ä½¿ç”¨å½“å‰ç›®å½•çš„ config.json
dbm

# ä½¿ç”¨æŒ‡å®šé…ç½®æ–‡ä»¶
dbm ./my-config.json

# ç”Ÿæˆé…ç½®æ–‡ä»¶æ¨¡æ¿
dbm --init

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
dbm --help
dbm -h

# æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
dbm --version
dbm -v
```

### æœ¬åœ°å¼€å‘ä½¿ç”¨

å¦‚æœæœªå…¨å±€å®‰è£…ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ï¼š

```bash
# ç›´æ¥è¿è¡Œè„šæœ¬
node merge-export.js

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
node merge-export.js ./my-config.json

# ä½¿ç”¨ npm scripts
npm run export
```

## æŠ€æœ¯åŸç†

### å¯¼å‡ºæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0. å¤šå¯¹å¤šå…³è”è¡¨è‡ªåŠ¨æ£€æµ‹ï¼ˆæ–°å¢ï¼‰                          â”‚
â”‚    â”œâ”€ è¿æ¥ Source æ•°æ®åº“                                 â”‚
â”‚    â”œâ”€ æŸ¥è¯¢ fields è¡¨ï¼ˆinterface = 'm2m'ï¼‰               â”‚
â”‚    â”œâ”€ è§£æ options JSON è·å– through å±æ€§                â”‚
â”‚    â”œâ”€ å°†å…³è”è¡¨æ·»åŠ åˆ° excludeTables åˆ—è¡¨                  â”‚
â”‚    â””â”€ è‡ªåŠ¨å»é‡                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Source æ•°æ®åº“                                         â”‚
â”‚    â”œâ”€ å¯¼å‡ºæ‰€æœ‰è¡¨ç»“æ„ (--no-data)                        â”‚
â”‚    â””â”€ å¯¼å‡ºéæ’é™¤è¡¨çš„æ•°æ® (--ignore-table)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. Target æ•°æ®åº“                                         â”‚
â”‚    â”œâ”€ è¿æ¥å¹¶éªŒè¯è¡¨å­˜åœ¨æ€§                                 â”‚
â”‚    â”œâ”€ è·å– Source è¡¨çš„åˆ—åï¼ˆä½œä¸ºåŸºå‡†ï¼‰                  â”‚
â”‚    â”œâ”€ è·å– Target è¡¨çš„åˆ—å                               â”‚
â”‚    â”œâ”€ è®¡ç®—åˆ—äº¤é›†ï¼ˆåªå¯¼å‡ºå…¬å…±åˆ—ï¼‰                         â”‚
â”‚    â””â”€ ç”Ÿæˆ REPLACE INTO è¯­å¥                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. æ•°æ®åˆå¹¶                                              â”‚
â”‚    â”œâ”€ DELETE FROM æ¸…ç©ºæ’é™¤è¡¨                             â”‚
â”‚    â”œâ”€ REPLACE INTO æ’å…¥ Target æ•°æ®                      â”‚
â”‚    â””â”€ è‡ªåŠ¨å¤„ç†ä¸»é”®å†²çª                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®æŠ€æœ¯ç‚¹

#### 1. å¤šå¯¹å¤šå…³è”è¡¨è‡ªåŠ¨æ£€æµ‹ï¼ˆæ–°å¢ï¼‰
```javascript
// æŸ¥è¯¢ fields è¡¨è·å–å¤šå¯¹å¤šå­—æ®µ
SELECT f.collection_name, f.name, f.options
FROM fields f
WHERE f.collection_name IN ('users', 'roles', ...)  -- æ’é™¤è¡¨åˆ—è¡¨
AND f.interface = 'm2m'
AND f.options IS NOT NULL

// è§£æ options JSON è·å–å…³è”è¡¨å
const options = JSON.parse(field.options);
const junctionTable = options.through;  // å¦‚: 'user_roles'

// è‡ªåŠ¨æ·»åŠ åˆ°æ’é™¤åˆ—è¡¨
excludeTables.push(junctionTable);
```

#### 2. DB_UNDERSCORED è¡¨åè½¬æ¢ï¼ˆæ–°å¢ï¼‰
```javascript
// é©¼å³°è½¬ä¸‹åˆ’çº¿
function camelToSnake(str) {
    return str.replace(/[A-Z]/g, letter => `_${letter.toLowerCase()}`);
}

// ä¸‹åˆ’çº¿è½¬é©¼å³°
function snakeToCamel(str) {
    return str.replace(/_([a-z])/g, (match, letter) => letter.toUpperCase());
}

// ç¤ºä¾‹
userRoles -> user_roles   (dbUnderscored: true)
user_roles -> userRoles   (dbUnderscored: false)
```

#### 3. BIGINT ç²¾åº¦ä¿æŠ¤
```javascript
// mysql2 é…ç½®
{
  supportBigNumbers: true,
  bigNumberStrings: true  // BIGINT ä½œä¸ºå­—ç¬¦ä¸²è¿”å›
}
```

#### 4. åˆ—åŒ¹é…ç®—æ³•
```javascript
sourceColumns = ['id', 'name', 'status', 'old_field']
targetColumns = ['id', 'name', 'status', 'new_field']
commonColumns = ['id', 'name', 'status']  // å–äº¤é›†

// åªæŸ¥è¯¢å…¬å…±åˆ—
SELECT `id`, `name`, `status` FROM target_table
```

#### 5. å»é‡ç­–ç•¥
```sql
-- æ¸…ç©ºè¡¨æ•°æ®
DELETE FROM `excluded_table`;

-- ä½¿ç”¨ REPLACE INTO è‡ªåŠ¨å¤„ç†é‡å¤
REPLACE INTO `excluded_table` (`id`, `name`, `status`) VALUES
('1939992168045813800', 'test', 'active');
```

## å¯¼å…¥ç”Ÿæˆçš„ SQL æ–‡ä»¶

```bash
mysql -u username -p database_name < merged_export.sql
```

æˆ–ä½¿ç”¨ MariaDBï¼š

```bash
mariadb -u username -p database_name < merged_export.sql
```

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªæ•°æ®åº“ï¼Ÿ
**A**: NocoBase ç‰ˆæœ¬å‡çº§æ—¶ï¼Œéœ€è¦æ–°ç‰ˆæœ¬çš„è¡¨ç»“æ„ï¼ˆSourceï¼‰ï¼Œä½†ä¿ç•™ç”Ÿäº§ç¯å¢ƒçš„ä¸šåŠ¡æ•°æ®ï¼ˆTargetï¼‰ã€‚

### Q2: å¦‚ä½•å¤„ç†è¡¨ç»“æ„ä¸ä¸€è‡´ï¼Ÿ
**A**: å·¥å…·ä¼šè‡ªåŠ¨è®¡ç®—åˆ—äº¤é›†ï¼Œåªå¯¼å‡ºä¸¤ä¸ªæ•°æ®åº“éƒ½å­˜åœ¨çš„åˆ—ï¼ŒSource ç‹¬æœ‰çš„åˆ—ä¼šä½¿ç”¨é»˜è®¤å€¼ã€‚

### Q3: å¯¼å…¥æ—¶æŠ¥ä¸»é”®å†²çªæ€ä¹ˆåŠï¼Ÿ
**A**: å·¥å…·ä½¿ç”¨ `REPLACE INTO` å’Œ `DELETE FROM`ï¼Œè‡ªåŠ¨å¤„ç†ä¸»é”®å†²çªï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚

### Q4: BIGINT ä¸»é”®é‡å¤é—®é¢˜ï¼Ÿ
**A**: å·²é…ç½® `bigNumberStrings: true`ï¼Œç¡®ä¿å¤§æ•´æ•°ä¸ä¼šå› ç²¾åº¦ä¸¢å¤±è€Œé‡å¤ã€‚

### Q5: å¦‚ä½•é€‰æ‹©é¢„è®¾è¡¨ç»„åˆï¼Ÿ
- **ç»„åˆ1ï¼ˆå®¡æ‰¹æ•°æ®ï¼‰**ï¼šåªéœ€è¦ä¿ç•™å®¡æ‰¹æµç¨‹è®°å½•
- **ç»„åˆ2ï¼ˆä¸šåŠ¡æ•°æ®ï¼‰**ï¼šåªéœ€è¦ä¿ç•™ä¸šåŠ¡æ•°æ®è¡¨
- **ç»„åˆ3ï¼ˆå…¨éƒ¨æ•°æ®ï¼‰**ï¼šå®Œæ•´è¿ç§»ç”Ÿäº§ç¯å¢ƒæ•°æ®ï¼ˆæ¨èï¼‰

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šNocoBase ç‰ˆæœ¬å‡çº§
```bash
# Source = æ–°ç‰ˆæœ¬ç©ºæ•°æ®åº“ï¼ˆè¡¨ç»“æ„æœ€æ–°ï¼‰
# Target = ç”Ÿäº§ç¯å¢ƒæ—§ç‰ˆæœ¬æ•°æ®åº“
dbm --init  # é€‰æ‹©ç»„åˆ3
```

### åœºæ™¯2ï¼šæµ‹è¯•ç¯å¢ƒåŒæ­¥ç”Ÿäº§æ•°æ®
```bash
# Source = æµ‹è¯•ç¯å¢ƒï¼ˆæœ€æ–°ä»£ç ï¼‰
# Target = ç”Ÿäº§ç¯å¢ƒï¼ˆçœŸå®æ•°æ®ï¼‰
dbm --init  # é€‰æ‹©ç»„åˆ2ï¼ˆä¸šåŠ¡æ•°æ®ï¼‰
```

### åœºæ™¯3ï¼šæ•°æ®åº“ç»“æ„å˜æ›´åæ•°æ®è¿ç§»
```bash
# Source = æ–°è¡¨ç»“æ„æ•°æ®åº“
# Target = æ—§è¡¨ç»“æ„æ•°æ®åº“
dbm  # è‡ªåŠ¨å¤„ç†åˆ—å·®å¼‚
```

## æ³¨æ„äº‹é¡¹

### å‰ç½®è¦æ±‚
1. âœ… ç¡®ä¿å·²å®‰è£… `mysqldump` æˆ– `mariadb-dump` å‘½ä»¤è¡Œå·¥å…·
2. âœ… Node.js ç‰ˆæœ¬ >= 14.0.0
3. âœ… æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´å­˜å‚¨å¯¼å‡ºæ–‡ä»¶

### å®‰å…¨å»ºè®®
1. âš ï¸ å¯¼å…¥å‰å…ˆå¤‡ä»½ç›®æ ‡æ•°æ®åº“
2. âš ï¸ åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯å¯¼å…¥æˆåŠŸåå†åº”ç”¨åˆ°ç”Ÿäº§
3. âš ï¸ å¤§å‹æ•°æ®åº“ï¼ˆ> 1GBï¼‰å¯¼å‡ºå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
4. âš ï¸ ç¡®ä¿ç½‘ç»œç¨³å®šï¼Œé¿å…å¯¼å‡ºä¸­æ–­

## å¯¹æ¯”ä¼ ç»Ÿæ–¹æ¡ˆ

| ç‰¹æ€§ | DBM å·¥å…· | çº¯ mysqldump | æ‰‹åŠ¨å¯¼å…¥å¯¼å‡º |
|------|---------|-------------|-------------|
| æ··åˆæ•°æ®æº | âœ… è‡ªåŠ¨ | âŒ ä¸æ”¯æŒ | âš ï¸ æ‰‹åŠ¨æ“ä½œ |
| åˆ—å·®å¼‚å¤„ç† | âœ… è‡ªåŠ¨åŒ¹é… | âŒ æŠ¥é”™ | âš ï¸ æ‰‹åŠ¨ä¿®æ”¹ SQL |
| BIGINT ç²¾åº¦ | âœ… ä¿æŠ¤ | âœ… æ­£å¸¸ | âš ï¸ æ˜“å‡ºé”™ |
| ä¸»é”®å†²çª | âœ… è‡ªåŠ¨å¤„ç† | âŒ æŠ¥é”™ | âš ï¸ æ‰‹åŠ¨å»é‡ |
| è™šæ‹Ÿè¡¨è¿‡æ»¤ | âœ… è‡ªåŠ¨ | âŒ ä¼šå¯¼å‡º | âš ï¸ æ‰‹åŠ¨æ’é™¤ |
| æ—¶é—´æˆ³ç®¡ç† | âœ… è‡ªåŠ¨ | âŒ éœ€æ‰‹åŠ¨ | âš ï¸ æ˜“è¦†ç›– |
| äº¤äº’å¼é…ç½® | âœ… å‘å¯¼å¼ | âŒ å‘½ä»¤è¡Œ | âŒ æ—  |

## è¾“å‡ºç¤ºä¾‹

ç”Ÿæˆçš„ SQL æ–‡ä»¶ç»“æ„ï¼š

```sql
-- ============================================================
-- NocoBase Database Merge Export Tool
-- ============================================================
-- Export Time: 2025-10-15 14:30:25
-- SOURCE DATABASE: nocobase_dev@127.0.0.1:3306
-- TARGET DATABASE: nocobase_prod@127.0.0.1:3306
-- EXCLUDED TABLES: approval_records, users, ...
-- ============================================================

-- Source çš„è¡¨ç»“æ„
CREATE TABLE `users` (...);
CREATE TABLE `approval_records` (...);

-- Source çš„æ•°æ®ï¼ˆéæ’é™¤è¡¨ï¼‰
INSERT INTO `departments` VALUES (...);

-- ============================================================
-- Data from target database for excluded tables
-- ============================================================

-- approval_records
-- Common columns: 8 (Source: 10, Target: 9)
-- Source-only columns: old_field, deprecated_col
-- Target-only columns: new_field

DELETE FROM `approval_records`;
REPLACE INTO `approval_records` (`id`,`name`,...) VALUES
('1939992168045813800','å®¡æ‰¹è®°å½•',...);
```

## ä¾èµ–è¦æ±‚

- Node.js >= 14.0.0
- MySQL/MariaDB å®¢æˆ·ç«¯å·¥å…· (mysqldump / mariadb-dump)
- npm åŒ…ï¼šmysql2, inquirer

## è®¸å¯è¯

MIT

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### å¼€å‘
```bash
git clone https://github.com/1615450788/nocobase-db-merge-export.git
cd nocobase-db-merge-export
npm install
npm link  # æœ¬åœ°æµ‹è¯•
```

### æµ‹è¯•
```bash
dbm --init
dbm
```
